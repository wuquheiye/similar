<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>外出申请</title>
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="../bootstrop/css/bootstrap.css">
    <link rel="stylesheet" href="../use/css/common.css">
<!--    模态框样式-->
    <link rel="stylesheet" href="/use/css/index.css">

    <link rel="stylesheet" href="../use/css/bootstrap-material-datetimepicker.css" />
    <link rel="stylesheet" type="text/css" href="../use/css/default.css">
    <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="../bootstrop/js/bootstrap.js"></script>
    <script type="text/javascript" src="https://cdn.bootcss.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    <!--日期控件-->
    <script type="text/javascript" src="../use/js/moment-with-locales.min.js"></script>
    <script type="text/javascript" src="../use/js/bootstrap-material-datetimepicker.js"></script>
    <script type="text/javascript" src="../myjs/httpData.config.js"></script>

<!--    模态框js-->
    <script type="text/javascript" charset="utf-8" src="../myjs/organization.js"></script>
</head>
<body>
<div class="container-fluid">
    <!--头部-->
    <div class="container navbar-fixed-top" style="background: white">
        <div class="row">
            <div class="col-xs-2">
                <a href="/use/index.html?publicBottomImages=publicBottomInformation"><h4><span class="glyphicon glyphicon-menu-left"
                                                        aria-hidden="true"></span></h4></a>
            </div>
            <div class="col-xs-8" style="text-align: center">
                <h4><b id="title">外出申请</b></h4></div>
        </div>
    </div>
    <!--<div class="container" style="padding-top: 55px">-->
    <!--<div class="row">-->
    <!--<div class="col-xs-12">-->
    <!--流程标题-->
    <!--</div>-->
    <!--<hr style="margin-top: 10px;margin-bottom: 10px;height:1px;width: 90%;background: #F4F4F4;margin: auto">-->
    <!--<div class="col-xs-12" style="padding-top: 10px" id="otTitle">-->
    <!--貂蝉_加班-->
    <!--</div>-->
    <!--</div>-->
    <!--</div>-->
    <!--<hr style="margin-top: 10px;margin-bottom: 10px;height:10px;width: 100%;background: #F4F4F4">-->

    <div class="container" style="padding-top: 55px">
        <div class="row">
            <div class="col-xs-6">
                申请人
            </div>
            <div class="col-xs-6">
                <div>
                        <span style="width: 85px;
                        border-radius: 30px;
                        background: ghostwhite;
                        text-align: center;
                        float: right;" id="otName">貂蝉</span>
                </div>
            </div>
        </div>
        <hr style="margin-top: 10px;margin-bottom: 10px;height:10px;width: 100%;background: #F4F4F4">
    </div>
    <div class="container">
        <div class="row">
            <div class="col-xs-6">
                部门
            </div>
            <div class="col-xs-6">
                <div>
                        <span style="width: 85px;
                        border-radius: 30px;
                        background: ghostwhite;
                        text-align: center;
                        float: right;"  id="otSection">研发部</span>
                </div>
            </div>
        </div>
        <hr style="margin-top: 10px;margin-bottom: 10px;height:10px;width: 100%;background: #F4F4F4">
    </div>
    <div class="container">
        <div class="row" >
            <div class="col-xs-6">
                同行人
            </div>
            <div class="col-xs-6">
                <button class="btn btn-primary btn-xs" data-toggle="modal" data-target="#myModal">
                    请选择同行人
                </button>
            </div>
            <div class="col-xs-12" id="personnel">
            </div>
            <div class="col-xs-12">
                <input type="hidden" value="" id="fchange">
            </div>
        </div>
        <hr style="margin-top: 10px;margin-bottom: 10px;height:10px;width: 100%;background: #F4F4F4">
    </div>
    <div class="container">
        <div class="row">
            <div class="col-xs-6">
                总人数
            </div>
            <div class="col-xs-6" id="zongnum">

            </div>
        </div>
        <hr style="margin-top: 10px;margin-bottom: 10px;height:10px;width: 100%;background: #F4F4F4">
    </div>
    <div class="container">
        <div class="row">
            <div class="col-xs-6">
                申请日期
            </div>
            <div class="col-xs-6">
                <span style="float: right;text-align: right" id="defuletTime"></span>
            </div>
        </div>
        <hr style="margin-top: 10px;margin-bottom: 10px;height:10px;width: 100%;background: #F4F4F4">
    </div>
    <div class="container">
        <div class="row" style="height: 35px">
            <div class="col-xs-6" style="line-height: 30px">
                申请开始
            </div>
            <div class="col-xs-6" style="line-height: 30px;padding-left: 0px">
                <input type="text" id="date-start" style="width: 100%;direction: rtl;border: 0px;outline:medium;" class="form-control floating-label" placeholder="Date">
            </div>
        </div>
        <hr style="margin-top: 10px;margin-bottom: 10px;height:1px;width: 90%;background: #F4F4F4;margin: auto">
        <div class="row" style="height: 35px">
            <div class="col-xs-6" style="line-height: 30px">
                申请结束
            </div>
            <div class="col-xs-6" style="line-height: 30px;padding-left: 0px">
                <input type="text" id="date-end" style="width: 100%;direction: rtl;border: 0px;outline:medium;" class="form-control floating-label" placeholder="Date" >
            </div>
        </div>
        <hr style="margin-top: 10px;margin-bottom: 10px;height:1px;width: 90%;background: #F4F4F4;margin: auto">
        <div class="row" style="height: 35px">
            <div class="col-xs-6" style="line-height: 30px">
                申请时长
            </div>
            <div class="col-xs-6" style="line-height: 30px;padding-left: 0px;text-align: right" id="duration">
            </div>
        </div>
        <hr style="margin-top: 10px;margin-bottom: 10px;height:1px;width: 90%;background: #F4F4F4;margin: auto">
        <div class="row" >
            <div class="col-xs-6" style="line-height: 30px">
                外出事由
            </div>
            <div class="col-xs-12" style="height: 130px;padding: 0px">
                <textarea class="form-control" style="height: 120px" id="fapplyReason"></textarea>
            </div>
        </div>
        <hr style="margin-top: 10px;margin-bottom: 10px;height:10px;width: 100%;background: #F4F4F4;margin: auto">


    </div>

    <!--审批-->
    <div class="container" style="padding-bottom: 70px">
<!--        <div class="row" style="line-height: 35px">-->
<!--            <div class="col-xs-12" style="line-height: 35px">-->
<!--                将申请推送给领导审批-->
<!--            </div>-->
<!--            <div class="col-xs-12" style="line-height: 35px">-->
<!--                <select class="form-control" id="fuidManager" style="border: 0px">-->
<!--                    <option value="0">选择推送领导</option>-->
<!--                    <option value="1">同意</option>-->
<!--                    <option value="2">拒绝</option>-->
<!--                </select>-->
<!--            </div>-->
<!--        </div>-->
        <div class="row" style="line-height: 35px">
            <div class="col-xs-12" style="line-height: 35px">
                将申请推送给领导审批
            </div>
            <div class="col-xs-12" style="line-height: 35px">
                <select class="form-control" id="fuidManager" style="border: 0px">

                </select>
            </div>
        </div>
    </div>
    <!--模态框 style="width: 100%;height: 100%;"-->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel">
                        请选择人员
                    </h4>
                </div>
                <div class="modal-body" id="content">
                    <div class="organizationContain">
                        <div class="organizationCenter organizationHeaderOrganization">
                            <!-- 查看被选中对象start -->
                            <div class="container containerTop">
                                <div class="row">
                                    <div class="col-xs-3">
                                        <a href="javascript:history.back(-1)"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span>取消</a>
                                    </div>
                                    <div class="col-xs-6 text-center">
                                        所有人
                                    </div>
                                    <div class="col-xs-3 text-center" onclick="clean()">
                                        清空
                                    </div>
                                </div>
                                <div class="row" id="getname">
                                    <button type="button" class="btn btn-primary">已选中的人员</button>
                                </div>
                            </div>
                            <!-- 查看被选中对象end -->

                            <!-- 组织列表 -->
                            <ul id="organizationHeaderOrganizationUiContain">
                            </ul>

                            <!-- 查看被选中对象start -->
                            <button type="button" class="btn btn-primary col-xs-12 navbar-fixed-bottom-button" onclick="affirm()">确认</button>
                            <!-- 查看被选中对象end -->
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal" onclick="close()">关闭</button>
                    <button type="button" class="btn btn-primary" onclick="tijiaoModal()">提交更改</button>
                </div>
            </div>
        </div>

    </div>

    <!--底部-->
    <div class="container navbar-fixed-bottom" >
        <button type="button" class="btn btn-primary btn-lg btn-block" onclick="commitflow()">提交申请</button>
    </div>
</div>
</body>
<script type="text/javascript" src="../myjs/common.js"></script>

<script>

    //缓存获取当前用户信息 , 并得到他的角色 loginObj.users.uid
    var loginObj = JSON.parse(window.sessionStorage.getItem("login"));



    $(function () {
        $("#otTitle").text(loginObj.users.uusername+"_加班");
        $("#otSection").text(loginObj.department.dname);
        $("#otName").text(loginObj.users.uusername);
        $("#defuletTime").text(getCurrentTime().split(" ")[0]);
        selectusersbyrid()
    })

    /**
     * 模态框选中
     */
    function tijiaoModal() {
        let value=[];
        let valuekey=[]
        $(".getallname:checked").each(function (e) {
            value.push(this.value);
            valuekey.push($(this).attr('valuekey'));
        })
        // alert(value);
        // alert(valuekey);
        // alert(value.length);
        let showdata = '<button type="button" class="btn btn-primary"  id="but_'+1+'">'+value+'</button>';
        $("#personnel").html(showdata);
        $("#fchange").val(value);
        // alert($("#fchange").val());
        $("#zongnum").text(value.length+"人");
        $("#myModal").modal('hide');
    }


    /**
     * 录入请假申请
     */
    function commitflow() {
        let ftype= ftypeFlow.GOOUT.code;
        let fapplyTime = $("#defuletTime").text();
        // let fleaveType = $("#fleaveType").val();//获取请假类型
        let fstartTime = $("#date-start").val();
        let fendTime = $("#date-end").val();
        let fapplyReason = $("#fapplyReason").val();
        let fchange = $("#fchange").val(); //通行人
        let fuidManager=$("#fuidManager").val();
        if(fuidManager!=0) {
            let leaveflow = {
                "ftype": ftype,
                "uid": loginObj.users.uid,
                // "fleaveType":fleaveType,
                "fapplyTime": fapplyTime,
                "fstartTime": fstartTime,
                "fendTime": fendTime,
                "fapplyReason": fapplyReason,
                "uusername": loginObj.users.uusername,
                "dname": loginObj.department.dname,
                "fchange": fchange,
                "fuidManager": fuidManager,
                // "artsVision":loginObj.department.ArtsVision
            }

            alert(JSON.stringify(leaveflow))
            $.ajax({
                url: pageDesignControl_HOST + "flow/leaveInsert",
                type: "post",
                dataType: "json",
                data: JSON.stringify(leaveflow),
                contentType: 'application/json; charset=UTF-8',
                async: false,
                success: function (res) {
                    if (res.msg == true) {
                        alert("申请已发出")
                    } else {
                        alert("申请发出失败");
                    }
                },
                error: function () {
                    alert("网络信号不好，请重试");
                }

            })
        }else {
            alert("请选择推送")
        }

    }


    $("#date-start").change(function () {
        // alert($("#date-end").val())
        if($("#date-end").val()!=''){
            // alert("val:"+$(this).val());
            let leadtime=leadTimeTwo($(this).val(),$("#date-end").val());
            $("#duration").text(leadtime);
        }

    })
    $("#date-end").change(function () {
        // alert($("#date-start").val())
        if($("#date-start").val()!=''){
            // alert("val:"+$(this).val());
            let leadtime=leadTimeTwo($("#date-start").val(),$(this).val());
            $("#duration").text(leadtime);
        }

    })

    // 日期插件
    $(document).ready(function() {
        $('#date').bootstrapMaterialDatePicker({
            time: true
        });
        $('#date_end').bootstrapMaterialDatePicker({
            time: true
        });

        $('#time').bootstrapMaterialDatePicker
        ({
            date: false,
            shortTime: true,
            format: 'HH:mm'
        });

        $('#date-format').bootstrapMaterialDatePicker
        ({
            format: 'dddd DD MMMM YYYY - HH:mm'
        });
        $('#date-fr').bootstrapMaterialDatePicker
        ({
            format: 'DD/MM/YYYY HH:mm',
            lang: 'fr',
            weekStart: 1,
            cancelText : 'ANNULER'
        });

        $('#date-end').bootstrapMaterialDatePicker
        ({
            weekStart: 0, format: 'DD/MM/YYYY HH:mm'
        });
        $('#date-start').bootstrapMaterialDatePicker
        ({
            weekStart: 0, format: 'DD/MM/YYYY HH:mm'
        }).on('change', function(e, date)
        {
            $('#date-end').bootstrapMaterialDatePicker('setMinDate', date);
        });

        $('#min-date').bootstrapMaterialDatePicker({ format : 'DD/MM/YYYY HH:mm', minDate : new Date() });

        $.material.init()
    });
</script>
</html>