<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>新建流程</title>
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="../bootstrop/css/bootstrap.css">
    <!--fileinputcss-->
    <link href="https://cdn.bootcss.com/bootstrap-fileinput/4.3.3/css/fileinput.min.css" rel="stylesheet">

    <link rel="stylesheet" href="../use/css/common.css">

    <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="../bootstrop/js/bootstrap.js"></script>
    <script src="https://at.alicdn.com/t/font_1502544_6qxgh0ec3xu.js"></script>
    <!--fileinput JS-->
    <script src="https://cdn.bootcss.com/bootstrap-fileinput/4.3.3/js/fileinput.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap-fileinput/4.3.5/js/locales/zh.min.js "></script>

    <!--    全局配置文件-->
    <script type="text/javascript" src="../myjs/httpData.config.js"></script>

</head>
<body>
<div class="container-fluid">
    <!--头部-->
    <div class="container navbar-fixed-top" style="background: white;border-bottom: 2px solid gainsboro">
        <div class="row">
            <div class="col-xs-2">
                <a href="/use/index.html?publicBottomImages=publicBottomInformation">
                <h4><span class="glyphicon glyphicon-menu-left"
                                                  aria-hidden="true"></span></h4></a>
            </div>
            <div class="col-xs-8" style="text-align: center">
                <h4><b id="title">日志</b></h4></div>
        </div>
    </div>
    <div class="container" style="padding-top: 80px;padding-bottom: 80px;">
        <div class="row">
            <div class="col-xs-12">
                <b>今日工作进行</b>
            </div>
            <div class="col-xs-12">
                <textarea  id="jnowTask" class="form-control" class="textarea" style='overflow-y: hidden;
                            border: 0px;box-shadow: inherit;padding:0px;line-height: 30px;height:35px'
                          onpropertychange="this.style.height = this.scrollHeight + 'px';"
                          oninput="this.style.height = this.scrollHeight + 'px';" onclink="textareasend();">
                </textarea>
            </div>


            <div class="col-xs-12" style="border-top: 2px solid #F4F4F4;padding-top: 10px">
                <b>计划安排</b>
            </div>
            <div class="col-xs-12">
                <textarea id="jtomorrowTask" class="form-control" class="textarea" style='overflow-y: hidden;
                            border: 0px;padding:0px;line-height: 30px;height:35px'
                          onpropertychange="this.style.height = this.scrollHeight + 'px';"
                          oninput="this.style.height = this.scrollHeight + 'px';" onclink="textareasend();">
                </textarea>
            </div>
            <div class="col-xs-12" style="border-top: 2px solid #F4F4F4;padding-top: 10px">
                <b>项目所属</b>
            </div>
            <div class="col-xs-12">
            <select class="form-control" style="border: 0px" id="pid">

            </select>
            <div class="col-xs-12" style="border-top: 2px solid #F4F4F4;padding-top: 10px">
                <b>建议提醒</b>
            </div>
            <div class="col-xs-12">
            <textarea id="jundoneTask" class="form-control" class="textarea" style='overflow-y: hidden;
                        border: 0px;padding:0px;line-height: 30px;height:35px'
                      onpropertychange="this.style.height = this.scrollHeight + 'px';"
                      oninput="this.style.height = this.scrollHeight + 'px';" onclink="textareasend();">
            </textarea>
            </div>
        </div>
        </div>
<!--        <div class="row" style="border-top: 10px solid gainsboro;padding-top: 10px;margin-top: 10px">-->
<!--            <div class="col-xs-12">-->
<!--                <div class="row">-->
<!--                    <div class="col-xs-6" style="line-height: 35px">-->
<!--                        图片-->
<!--                    </div>-->
<!--                    <div class="col-xs-6" style="text-align: right">-->
<!--                        <svg class="icon" aria-hidden="true" style="width: 30px;height: 30px;color: #2aabd2">-->
<!--                            <use xlink:href="#icon-14"></use>-->
<!--                        </svg>-->
<!--                    </div>-->
<!--                    <div class="col-xs-12">-->
<!--                        <input id="file-1" type="file" multiple class="file" data-overwrite-initial="false" data-min-file-count="2">-->
<!--                    </div>-->
<!--                    <div class="col-xs-12" style="display: none ;" id="picture">-->
<!--                        <ul class="list-group row">-->
<!--                            <li class="list-group-item col-xs-4">-->
<!--                                <img src="../use/image/日报.png" style=" width: 40px;height: 40px;">-->
<!--                                <span style="display: inline-block;-->
<!--                                            border-radius: 50%;-->
<!--                                            background: blue;-->
<!--                                            color: white;-->
<!--                                            width: 10px;-->
<!--                                            height: 11px;-->
<!--                                            font-size: 3px;-->
<!--                                            left: -13px;-->
<!--                                            top: -15px;-->
<!--                                            position: relative;" class=" removePicture">X</span>-->
<!--                            </li>-->
<!--                        </ul>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
    </div>



    <!--底部-->
    <div class="container navbar-fixed-bottom" >
        <div class="row" style="border-top: 2px solid gainsboro;text-align: center;line-height: 35px">
            <button type="button" class="btn btn-primary btn-lg btn-block" onclick="insertJournal()">提交</button>
        </div>
    </div>
</div>
</body>
<script  type="text/javascript" src="../myjs/common.js"></script>
<script>

    //缓存获取当前用户信息 , 并得到他的角色 loginObj.users.uid
    var loginObj = JSON.parse(window.sessionStorage.getItem("login"));
    $(function () {
        $.ajax({
            url: pageDesignControl_HOST + "project/selectAllProject?uid="+loginObj.users.uid,
            type: "get",
            dataType: "json",
            // data:JSON.stringify(journal),
            contentType: 'application/json; charset=UTF-8',
            async: false,
            success: function(res) {
                let showdata='';
                showdata+='<option value="0">请选择所属项目,如无可不选</option>\n';
                if(res.msg!="") {
                    $.each(res.msg, function (index, value) {
                        showdata += '<option value=' + value.pid + '>' + value.pname + '</option>\n';
                    })
                }
                $("#pid").html(showdata);
            },
            error: function(){
                alert("网络信号不好，请重试");
            }

        })
    })
    $("#file-1").fileinput({
        language: 'zh', //设置语言
        uploadUrl: pageDesignControl_HOST +"/journal/picture", //上传的地址
        allowedFileExtensions: ['jpg', 'gif', 'png','jpeg','bmp'],//接收的文件后缀
        //showUploadedThumbs:false,
        // uploadClass: 'hidden',
        uploadLabel: "上传",//设置上传按钮的汉字
        initialCaption: "请上传商家logo",//文本框初始话value
//			initialPreview:[ '<img src='/hotelSystem\files/' class='file-preview-image' alt='Desert' title='Desert'>',],预览图片
        showUpload: false, //是否显示上传按钮
        showCaption: false,//是否显示标题
        browseClass: "btn btn-info", //按钮样式
        dropZoneEnabled: false,//是否显示拖拽区域
        showRemove: false,//是否显示移除
        // minImageWidth: 30, //图片的最小宽度
        // minImageHeight: 30,//图片的最小高度
        // maxImageWidth: 50,//图片的最大宽度
        // maxImageHeight: 50,//图片的最大高度
        maxFileSize: 1000,//单位为kb，如果为0表示不限制文件大小
        maxFileCount: 5, //表示允许同时上传的最大文件个数
        minFileCount: 0,
        enctype: 'multipart/form-data',
        validateInitialCount: true,//有效初始化计数
        previewFileIcon: "<i class='glyphicon glyphicon-king'></i>",
        msgFilesTooMany: "选择上传的文件数量({n}) 超过允许的最大数值{m}！",
        // maxFileSize: 1000,
        // maxFilesNum: 2,
        overwriteInitial: false,
        fileActionSettings : {
            showUpload: false,//是否显示上传小图标
            //owRemove: false//是否显示删除小图标
        },
        //将文件名中间的-替换成_  回调函数
        slugCallback : function(filename) {
            return filename.replace('(', '_').replace(']', '_');
        }

    });

    //获取当前时间
    function getCurrentDate(){
        var timeStr = '-';
        var curDate = new Date();
        var curYear =curDate.getFullYear();  //获取完整的年份(4位,1970-????)
        var curMonth = curDate.getMonth()+1;  //获取当前月份(0-11,0代表1月)
        var curDay = curDate.getDate();       //获取当前日(1-31)
        var curWeekDay = curDate.getDay();    //获取当前星期X(0-6,0代表星期天)
        var curHour = curDate.getHours();      //获取当前小时数(0-23)
        var curMinute = curDate.getMinutes();   // 获取当前分钟数(0-59)
        var curSec =curDate.getSeconds();      //获取当前秒数(0-59)
        if(curSec<10){
            curSec = '0'+curSec;
        }
        if(curMinute<10){
            curMinute = '0'+curMinute;
        }
        var Current= curYear+timeStr+curMonth+timeStr+curDay+' '+curHour+':'+curMinute+':'+curSec;
        console.log(Current);
        // this.datetime=Current;
        return Current;
    }

    /**
     *  日志提交
     */
    function insertJournal() {
        let uid = loginObj.users.uid; //缓存获取当前用户信息
        let username  = loginObj.users.uusername;//缓存获取当前用户名
        let jnowTask = $("#jnowTask").val();
        let jundoneTask = $("#jundoneTask").val();
        let jtomorrowTask = $("#jtomorrowTask").val();
        let pid = $("#pid").val();
        let nowtime= getCurrentDate();

        let journal = {
            "uid" : uid,
            "uusername" : username,
            "jnowTask" : jnowTask,
            "jundoneTask" : jundoneTask,
            "jtomorrowTask" :jtomorrowTask,
            "pid" :pid,
            "jcreateTime" : nowtime,
            "fuidCharge" :loginObj.users.fuidCharge,
            "fuidManager":loginObj.users.fuidManager
        }
        alert(JSON.stringify(journal))
        $.ajax({
            url: pageDesignControl_HOST + "journal/insertJournal",
            type: "post",
            dataType: "json",
            data:JSON.stringify(journal),
            contentType: 'application/json; charset=UTF-8',
            async: false,
            success: function(res) {
                if(res.msg==true){
                    alert("申请已发出")
                }else{
                    alert("申请发出失败");
                }
            },
            error: function(){
                alert("网络信号不好，请重试");
            }

        })


    }

</script>
</html>